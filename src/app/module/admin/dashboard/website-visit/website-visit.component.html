<div class="p-6 space-y-6">
  <!-- Summary Card -->
  <mat-card class="bg-gradient-to-br from-blue-50 to-white shadow-lg">
    <mat-card-content class="p-6 !flex !flex-col !items-center !justify-center">
      <h2 class="text-2xl font-bold mb-2">Website Visits</h2>
      <div class="text-5xl font-extrabold text-blue-600 mb-2">
        @if (visitCount !== null) {
          <ng-container>{{ visitCount | number }}</ng-container>
        } @else {
          <span class="text-gray-400 animate-pulse">...</span>
        }
      </div>
      <div class="text-gray-500">Total visits recorded</div>
    </mat-card-content>
  </mat-card>

  <!-- Visits Table -->
  <mat-card class="shadow-lg">
    <mat-card-header class="px-6 py-4 border-b border-gray-200">
      <div class="flex justify-between items-center w-full">
        <mat-card-title class="text-xl font-semibold text-gray-800">
          Visit Details
        </mat-card-title>
        <button mat-raised-button color="primary" (click)="refresh()" class="flex items-center gap-2">
          <mat-icon>refresh</mat-icon>
          Refresh
        </button>
      </div>
    </mat-card-header>

    <mat-card-content class="p-0 relative">
      @if (isLoading) {
        <div class="flex justify-center items-center py-12">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
      } @else {
        @if (isLoadingPage) {
          <div class="absolute inset-0 bg-white bg-opacity-75 flex justify-center items-center z-10">
            <mat-spinner diameter="24"></mat-spinner>
          </div>
        }
        <div class="overflow-x-auto max-h-[70vh]">
          <table mat-table [dataSource]="dataSource" matSort class="w-full">
            <!-- IP Column -->
            <ng-container matColumnDef="ip">
              <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                IP Address
              </th>
              <td mat-cell *matCellDef="let visit" class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ visit.ip }}
              </td>
            </ng-container>

            <!-- User Agent Column -->
            <ng-container matColumnDef="userAgent">
              <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                User Agent
              </th>
              <td mat-cell *matCellDef="let visit" class="px-6 py-4 text-sm text-gray-900 max-w-xs truncate" [title]="visit.userAgent">
                {{ visit.userAgent }}
              </td>
            </ng-container>

            <!-- Visited At Column -->
            <ng-container matColumnDef="visitedAt">
              <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Visit Time
              </th>
              <td mat-cell *matCellDef="let visit" class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ visit.visitedAt | date:'medium' }}
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="bg-gray-50"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns" 
                class="hover:bg-gray-50 transition-colors duration-200 ease-in-out"></tr>
          </table>
        </div>

        <!-- No data message -->
        @if (dataSource.data.length === 0 && !isLoadingPage) {
          <div class="text-center py-12 text-gray-500">
            <mat-icon class="text-4xl mb-2">web</mat-icon>
            <p>No website visits found</p>
          </div>
        }
      }
    </mat-card-content>

    <!-- Pagination -->
    @if (!isLoading && dataSource.data.length > 0) {
      <mat-card-footer class="px-6 py-4 border-t border-gray-200 bg-gray-50">
        <mat-paginator
          [length]="totalItems"
          [pageSize]="limit"
          [pageIndex]="page - 1"
          [pageSizeOptions]="[5, 10, 25, 50]"
          (page)="onPageChange($event)"
          showFirstLastButtons
          class="w-full">
        </mat-paginator>
      </mat-card-footer>
    }
  </mat-card>
</div>