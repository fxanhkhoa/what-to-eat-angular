<!-- Loading State -->
@if (loading()) {
<div class="min-h-screen flex justify-center items-center bg-gradient-to-br from-neutral-900 to-neutral-800">
    <mat-spinner diameter="60" class="!text-primary-500"></mat-spinner>
</div>
}

<!-- Empty State -->
@else if (dish() === null) {
<div class="min-h-screen bg-gradient-to-br from-neutral-900 to-neutral-800 p-5 md:p-10">
    <app-empty></app-empty>
</div>
}

<!-- Main Content -->
@else if (dish()) {
<div class="min-h-screen bg-gradient-to-br from-neutral-900 via-neutral-800 to-neutral-900">

    <!-- Hero Banner with Overlay -->
    <section class="relative h-[70vh] md:h-[85vh] overflow-hidden">
        <!-- Background Image -->
        <div class="absolute inset-0 bg-cover bg-center bg-no-repeat transform scale-105 transition-transform duration-700 hover:scale-110"
            [style.background-image]="dishThumbUrl()"></div>

        <!-- Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-b from-black/40 via-black/30 to-neutral-900"></div>

        <!-- Back Button -->
        <div class="absolute top-32 left-6 z-10">
            <button mat-fab extended (click)="goBack()"
                class="!bg-black/50 backdrop-blur-md !text-white hover:!bg-black/70 transition-all duration-300">
                <mat-icon>arrow_back</mat-icon>
                <span class="ml-2" i18n>Back</span>
            </button>
        </div>

        <!-- Hero Content -->
        <div class="absolute bottom-0 left-0 right-0 p-6 md:p-12">
            <div class="max-w-7xl mx-auto">
                <div class="space-y-6">
                    <!-- Title -->
                    <h1
                        class="text-5xl md:text-7xl font-black tracking-tight text-white drop-shadow-2xl animate-fade-in-up">
                        <span
                            class="bg-gradient-to-r from-[#FFB86A] via-[#F3A446] to-[#C98124] bg-clip-text text-transparent">
                            {{ (dish()!.title | multiLanguage: localeId)?.data }}
                        </span>
                    </h1>

                    <!-- Description -->
                    <p class="text-xl md:text-2xl text-gray-200 max-w-3xl font-light leading-relaxed">
                        {{ (dish()!.shortDescription | multiLanguage: localeId)?.data }}
                    </p>

                    <!-- Quick Info Pills -->
                    <div class="flex flex-wrap gap-4">
                        <!-- Difficulty Badge -->
                        <div class="px-6 py-3 rounded-full backdrop-blur-xl border border-white/20 flex items-center gap-2"
                            [ngClass]="{
                   'bg-green-500/20 border-green-400/30': dish()!.difficultLevel === 'EASY',
                   'bg-yellow-500/20 border-yellow-400/30': dish()!.difficultLevel === 'MEDIUM',
                   'bg-red-500/20 border-red-400/30': dish()!.difficultLevel === 'HARD'
                 }">
                            <mat-icon class="text-white text-xl">whatshot</mat-icon>
                            <span class="text-white font-semibold uppercase text-sm tracking-wider">
                                {{ dish()!.difficultLevel ?? 'N/A' | categoryTranslate }}
                            </span>
                        </div>

                        <!-- Prep Time -->
                        <div
                            class="px-6 py-3 rounded-full bg-white/10 backdrop-blur-xl border border-white/20 flex items-center gap-3">
                            <mat-icon svgIcon="preparation_time" class="text-orange-400"></mat-icon>
                            <div class="text-white">
                                <span class="font-bold">{{dish()?.preparationTime}}</span>
                                <span class="ml-1 text-sm" i18n="@@minutes">min prep</span>
                            </div>
                        </div>

                        <!-- Cooking Time -->
                        <div
                            class="px-6 py-3 rounded-full bg-white/10 backdrop-blur-xl border border-white/20 flex items-center gap-3">
                            <mat-icon svgIcon="cooking_time" class="text-amber-600"></mat-icon>
                            <div class="text-white">
                                <span class="font-bold">{{dish()?.cookingTime}}</span>
                                <span class="ml-1 text-sm" i18n="@@minutes">min cook</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content Section -->
    <section class="max-w-7xl mx-auto px-4 md:px-8 py-12 space-y-12">

        <!-- Categories -->
        <div class="flex flex-wrap gap-3 justify-center md:justify-start">
            <app-category-badges [categories]="categories()"></app-category-badges>
        </div>

        <!-- Video & Ingredients Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- Video Section -->
            <div class="space-y-6">
                <div class="flex items-center gap-3 mb-6">
                    <mat-icon class="text-orange-400 text-3xl">play_circle</mat-icon>
                    <h2 class="text-3xl font-bold text-white">Video Tutorial</h2>
                </div>

                @if (dish()?.videos && dish()!.videos.length > 0) {
                <div class="space-y-6">
                    <!-- Main Video Player -->
                    <div
                        class="relative rounded-2xl overflow-hidden shadow-2xl ring-2 ring-orange-500/20 hover:ring-orange-500/40 transition-all duration-300">
                        <youtube-player class="w-full aspect-video" [videoId]="currentVideoId()"
                            (ready)="onPlayerReady($event)" (stateChange)="onPlayerStateChange($event)">
                        </youtube-player>
                    </div>

                    <!-- Video Navigation Thumbnails -->
                    @if (dish()!.videos.length > 1) {
                    <div class="space-y-4">
                        <div class="flex flex-wrap gap-3 justify-center">
                            @for (video of dish()!.videos; track video; let i = $index) {
                            <button (click)="selectVideo(i)"
                                class="relative group overflow-hidden rounded-xl transition-all duration-300 hover:scale-110 focus:outline-none"
                                [class]="i === currentVideoIndex() 
                    ? 'ring-4 ring-orange-500 shadow-xl shadow-orange-500/50' 
                    : 'ring-2 ring-white/10 hover:ring-white/30'">
                                <img [src]="getYouTubeThumbnail(video)" [alt]="'Video ' + (i + 1)"
                                    class="w-24 h-16 object-cover" loading="lazy" (error)="onThumbnailError($event)">

                                <!-- Play Icon Overlay -->
                                <div
                                    class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-center justify-center">
                                    <mat-icon class="text-white text-3xl drop-shadow-lg"
                                        [class.scale-125]="i === currentVideoIndex()">
                                        play_circle
                                    </mat-icon>
                                </div>

                                <!-- Active Indicator -->
                                @if (i === currentVideoIndex()) {
                                <div
                                    class="absolute top-2 right-2 w-3 h-3 bg-orange-500 rounded-full animate-pulse ring-2 ring-white">
                                </div>
                                }
                            </button>
                            }
                        </div>

                        <!-- Video Counter -->
                        <div class="text-center">
                            <span
                                class="px-4 py-2 rounded-full bg-white/5 border border-white/10 text-white text-sm font-medium">
                                {{ currentVideoIndex() + 1 }} / {{ dish()!.videos.length }}
                            </span>
                        </div>
                    </div>
                    }
                </div>
                } @else {
                <!-- No Videos Placeholder -->
                <div
                    class="aspect-video rounded-2xl bg-gradient-to-br from-neutral-800 to-neutral-900 border border-white/10 flex items-center justify-center">
                    <div class="text-center text-gray-400 p-8">
                        <mat-icon class="text-7xl mb-4 opacity-30">videocam_off</mat-icon>
                        <p class="text-xl font-medium" i18n>No video available</p>
                        <p class="text-sm mt-2 opacity-70" i18n>This dish doesn't have any video tutorials yet</p>
                    </div>
                </div>
                }
            </div>

            <!-- Ingredients Section -->
            <div class="space-y-6">
                <div class="flex items-center gap-3 mb-6">
                    <mat-icon class="text-amber-600 text-3xl">restaurant</mat-icon>
                    <h2 class="text-3xl font-bold text-white" i18n="@@ingredients">Ingredients</h2>
                </div>

                <div
                    class="bg-gradient-to-br from-white/5 to-white/[0.02] backdrop-blur-xl rounded-2xl border border-white/10 p-6 shadow-xl">
                    <ul class="space-y-4 list-none">
                        @for (item of ingredients(); track item._id) {
                        <li class="group">
                            <div
                                class="flex items-center gap-4 p-3 rounded-xl hover:bg-white/5 transition-all duration-200">
                                <mat-checkbox [id]="item?.slug || newUUID" class="flex-shrink-0">
                                    <span class="sr-only">{{ (item.title | multiLanguage: localeId)?.data }}</span>
                                </mat-checkbox>

                                <label [for]="item?.slug || newUUID"
                                    class="flex-1 grid grid-cols-12 gap-3 items-center cursor-pointer">
                                    <div class="col-span-4 text-orange-400 font-bold text-sm">
                                        {{ getQuantity(item) }} {{ item.measure }}
                                        @if (getNote(item)) {
                                        <span class="block text-xs text-gray-500 mt-1">{{ getNote(item) }}</span>
                                        }
                                    </div>
                                    <div class="col-span-8 text-white font-medium">
                                        {{ (item.title | multiLanguage: localeId)?.data }}
                                    </div>
                                </label>

                                <a mat-icon-button target="_blank"
                                    [href]="'/ingredient?keyword=' + (item?.slug?.replaceAll('-', ' '))"
                                    [attr.aria-label]="(item.title | multiLanguage: localeId)?.data"
                                    class="!text-gray-400 hover:!text-orange-400 opacity-0 group-hover:opacity-100 transition-all duration-200">
                                    <mat-icon>open_in_new</mat-icon>
                                </a>
                            </div>
                        </li>
                        }
                    </ul>
                </div>
            </div>
        </div>

        <!-- Recipe Instructions -->
        <div class="space-y-6">
            <div class="flex items-center gap-3 mb-6">
                <mat-icon class="text-orange-400 text-3xl">menu_book</mat-icon>
                <h2 class="text-3xl font-bold text-white">Instructions</h2>
            </div>

            <div
                class="bg-gradient-to-br from-white/5 to-white/[0.02] backdrop-blur-xl rounded-2xl border border-white/10 p-8 shadow-xl">
                <div class="dish-html-wrapper max-h-[80vh] overflow-y-auto prose prose-invert prose-lg max-w-none custom-scrollbar"
                    [innerHTML]="getContent()">
                </div>
            </div>
        </div>

        <!-- Share Section -->
        <div class="flex flex-col items-center gap-6 py-12">
            <h3 class="text-2xl font-bold text-white">Share this recipe</h3>
            <div class="flex flex-wrap gap-4 justify-center">
                <button mat-fab extended (click)="copyLink()"
                    class="!bg-gradient-to-r !from-orange-500 !to-orange-600 !text-white hover:!from-orange-600 hover:!to-orange-700 !font-semibold">
                    <mat-icon>link</mat-icon>
                    <span class="ml-2 font-semibold" i18n>Copy Link</span>
                </button>

                <a [href]="'https://www.facebook.com/sharer/sharer.php?u=' + pageUrl()" target="_blank"
                    rel="noopener noreferrer">
                    <button mat-fab extended class="!bg-blue-700 !text-white hover:!bg-[#0C63D4] !font-semibold">
                        <mat-icon svgIcon="facebook"></mat-icon>
                        <span class="ml-2 font-semibold">Facebook</span>
                    </button>
                </a>

                <a [href]="'https://tiktok.com'" target="_blank" rel="noopener noreferrer">
                    <button mat-fab extended
                        class="!bg-black !text-white hover:!bg-neutral-800 !border !border-white/20 !font-semibold">
                        <mat-icon svgIcon="tiktok"></mat-icon>
                        <span class="ml-2 font-semibold">TikTok</span>
                    </button>
                </a>

                <a [href]="'mailto:?subject=' + (dish()?.title! | multiLanguage: localeId)?.data + '&body=' + (dish()?.shortDescription! | multiLanguage: localeId)?.data + ' ' + pageUrl()"
                    target="_blank" rel="noopener noreferrer">
                    <button mat-fab extended
                        class="!bg-gradient-to-r !from-amber-700 !to-amber-800 !text-white hover:!from-amber-800 hover:!to-amber-900 !font-semibold">
                        <mat-icon>mail</mat-icon>
                        <span class="ml-2 font-semibold" i18n>Email</span>
                    </button>
                </a>
            </div>
        </div>

        <!-- Divider -->
        <div class="h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>

        <!-- Related Dishes -->
        <div class="space-y-8">
            <div class="text-center space-y-3">
                <h2 class="text-4xl md:text-5xl font-black">
                    <span
                        class="bg-gradient-to-r from-[#FFB86A] via-[#F3A446] to-[#C98124] bg-clip-text text-transparent"
                        i18n="@@related_dishes">
                        Related Dishes
                    </span>
                </h2>
                <p class="text-gray-400 text-lg">Discover more delicious recipes</p>
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                @for (dish of relatedDishes(); track dish.slug) {
                <div class="transform transition-all duration-300 hover:scale-105">
                    <app-dish-card-fancy [dish]="dish"></app-dish-card-fancy>
                </div>
                }
            </div>
        </div>

    </section>
</div>
}