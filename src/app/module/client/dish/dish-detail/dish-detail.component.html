@if (!loading() && dish()) {
<section id="banner" class="h-[20rem] md:h-[40rem] relative bg-center bg-no-repeat bg-cover rounded-b-2xl"
    [style]="'background-image:' + dishThumbUrl()"></section>
}


<section id="main" class="p-5 md:p-10 mt-20">
    <div class="flex justify-start mb-5">
        <button matButton="elevated" (click)="goBack()">
            <mat-icon>chevron_left</mat-icon>
            <span i18n>Back</span>
        </button>
    </div>
    @if (loading()) {
    <div class="flex justify-center items-center h-96">
        <mat-spinner diameter="50"></mat-spinner>
    </div>
    } @else if (dish() === null) {
    <app-empty></app-empty>
    }
    @else {
    <div class="flex flex-col gap-5 md:gap-10">
        <div class="grid grid-cols-12 gap-5 md:gap-10">
            <div class="col-span-12 md:col-span-6 flex flex-col justify-center p-3">
                <h1
                    class="font-bold drop-shadow-lg text-5xl tracking-wider bg-gradient-to-r from-[#F3A446] to-[#A06235] text-transparent bg-clip-text">
                    {{ (dish()!.title | multiLanguage: localeId)?.data}}
                </h1>
            </div>
            <div
                class="col-span-12 md:col-span-6 flex flex-col gap-2 p-3 glassmorphic-container_dark rounded-lg text-gray-200">
                <!-- DifficultyLevelComponent should be implemented separately -->
                <span i18n=' EASY|MEDIUM|HARD' [ngClass]="{
                                    'neumorphic-easy': dish()!.difficultLevel === 'EASY',
                                    'neumorphic-medium': dish()!.difficultLevel === 'MEDIUM',
                                    'neumorphic-hard': dish()!.difficultLevel === 'HARD'
                                }" class="text-xl uppercase w-fit">
                    {{ dish()!.difficultLevel ?? 'N/A' | categoryTranslate }}
                </span>
                <h5 class="font-light text-lg">
                    {{ (dish()!.shortDescription | multiLanguage: localeId)?.data}}
                </h5>
                <div class="flex justify-start gap-5 mb-2">
                    <div class="flex items-center gap-4 cursor-default" i18n-matTooltip="@@preparation_time"
                        [matTooltip]="'Preparation Time'">
                        <mat-icon svgIcon="preparation_time"></mat-icon>
                        <div class="flex gap-1 text-lg mt-1">
                            <span>{{dish()?.preparationTime}}</span>
                            <span i18n="@@minutes">Minutes</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 cursor-default" i18n-matTooltip="@@cooking_time"
                        [matTooltip]="'Cooking Time'">
                        <mat-icon svgIcon="cooking_time"></mat-icon>
                        <div class="flex gap-1 text-lg mt-1">
                            <span>{{dish()?.cookingTime}}</span>
                            <span i18n="@@minutes">Minutes</span>
                        </div>
                    </div>
                </div>
                <div class="w-full overflow-auto flex flex-no-wrap">
                    <app-category-badges [categories]="categories()"></app-category-badges>
                </div>
            </div>
        </div>
        <div class="grid grid-cols-12 gap-5 md:gap-10 mt-5">
            <!-- videos part -->
            <div class="col-span-12 md:col-span-6 p-3">
                @if (dish()?.videos && dish()!.videos.length > 0) {
                <div class="space-y-4">
                    <!-- Main Video Player -->
                    <div class="relative w-full max-w-2xl mx-auto bg-black rounded-lg overflow-hidden shadow-2xl">
                        <youtube-player 
                            class="w-full aspect-video" 
                            [videoId]="currentVideoId()"
                            (ready)="onPlayerReady($event)"
                            (stateChange)="onPlayerStateChange($event)">
                        </youtube-player>
                    </div>

                    <!-- Video Navigation -->
                    @if (dish()!.videos.length > 1) {
                    <div class="flex flex-wrap gap-3 justify-center">
                        @for (video of dish()!.videos; track video; let i = $index) {
                        <button 
                            (click)="selectVideo(i)"
                            [class.active-video]="i === currentVideoIndex()"
                            class="relative group overflow-hidden rounded-lg border-2 transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            [class]="i === currentVideoIndex() ? 'border-blue-500 shadow-lg' : 'border-gray-600 hover:border-gray-400'">
                            <img 
                                [src]="getYouTubeThumbnail(video)" 
                                [alt]="'Video ' + (i + 1)"
                                class="w-20 h-12 object-cover"
                                loading="lazy"
                                (error)="onThumbnailError($event)">
                            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-all duration-300 flex items-center justify-center">
                                <mat-icon class="text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-2xl">play_arrow</mat-icon>
                            </div>
                            @if (i === currentVideoIndex()) {
                            <div class="absolute top-1 right-1 w-3 h-3 bg-blue-500 rounded-full animate-pulse"></div>
                            }
                        </button>
                        }
                    </div>

                    <!-- Video Counter -->
                    <div class="text-center text-sm text-gray-400">
                        {{ currentVideoIndex() + 1 }} / {{ dish()!.videos.length }}
                    </div>
                    }
                </div>
                } @else {
                <!-- No videos placeholder -->
                <div class="relative w-full max-w-2xl mx-auto bg-gray-800 rounded-lg overflow-hidden shadow-2xl aspect-video flex items-center justify-center">
                    <div class="text-center text-gray-400">
                        <mat-icon class="text-6xl mb-4">videocam_off</mat-icon>
                        <p class="text-lg" i18n>No video available</p>
                        <p class="text-sm" i18n>This dish doesn't have any video tutorials yet</p>
                    </div>
                </div>
                }
            </div>
            <div class="col-span-12 md:col-span-6 p-3 text-gray-200 glassmorphic-container_dark rounded-lg">
                <div class="flex">
                    <h4 i18n="@@ingredients">ingredients</h4>
                </div>
                <ul class="list-none">
                    @for (item of ingredients(); track item._id) {
                    <div class="inline-flex md:flex gap-2 items-center w-full">
                        <mat-checkbox [id]="item?.slug || newUUID"></mat-checkbox>
                        <label class="flex-1 mt-px font-light cursor-pointer select-none" [for]="item?.slug">
                            <div class="grid grid-cols-12 gap-2">
                                <div class="col-span-4 font-bold my-auto">
                                    {{ getQuantity(item) }}
                                    {{ item.measure }}
                                    ( {{ getNote(item) }} )
                                </div>
                                <div class="col-span-8 my-auto">
                                    {{ (item.title| multiLanguage: localeId)?.data }}
                                </div>
                            </div>
                        </label>
                        <div>
                            <a matIconButton target="_blank" [href]="'/ingredient?keyword=' + (item?.slug?.replaceAll('-', ' '))">
                                <mat-icon>open_in_new</mat-icon>
                            </a>
                        </div>
                    </div>
                    }
                </ul>
            </div>
        </div>
        <div class="grid grid-cols-12 gap-5 md:gap-10 mt-5 glassmorphic-container_dark rounded-lg">
            <div class="col-span-12 p-3 max-h-[80vh] overflow-y-auto">
                <div class="dish-html-wrapper" [innerHTML]="getContent()"></div>
            </div>
        </div>
        <div class="flex justify-center gap-3">
            <button mat-stroked-button color="primary" (click)="copyLink()">
                <mat-icon>link</mat-icon>
                <span i18n>Copy</span>
            </button>
            <a [href]="'https://www.facebook.com/sharer/sharer.php?u=' + pageUrl()" target="_blank">
                <button mat-stroked-button color="primary">
                    <mat-icon svgIcon="facebook"></mat-icon>
                    <span>Facebook</span>
                </button>
            </a>
            <a [href]="'https://tiktok.com'" target="_blank">
                <button mat-stroked-button color="primary">
                    <mat-icon svgIcon="tiktok"></mat-icon>
                    <span>Tiktok</span>
                </button>
            </a>
            <a [href]="'mailto:?subject=' + (dish()?.title! | multiLanguage: localeId)?.data + '&body=' + (dish()?.shortDescription! | multiLanguage: localeId)?.data + ' ' + pageUrl()"
                target="_blank">
                <button mat-stroked-button color="primary">
                    <mat-icon>mail</mat-icon>
                    <span i18n>Mail</span>
                </button>
            </a>
        </div>
        <hr />
        <div class="rounded-lg p-3">
            <div class="flex justify-center mb-3">
                <h2 class="text-3xl font-bold bg-gradient-to-r from-[#F3A446] to-[#A06235] text-transparent bg-clip-text" i18n="@@related_dishes">Related Dishes</h2>
            </div>
            <div class="grid grid-cols-12 gap-5">
                @for (dish of relatedDishes(); track dish.slug) {
                <div class="col-span-12 xl:col-span-6 mx-auto xl:mx-0">
                    <app-dish-card-fancy [dish]="dish"></app-dish-card-fancy>
                </div>
                }
            </div>
        </div>
    </div>
    }
</section>