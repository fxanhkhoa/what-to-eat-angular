<!-- Header Section -->
<section class="p-5 md:p-10 mt-20">
    <div class="max-w-7xl mx-auto">

        <h1 class="text-3xl font-bold bg-gradient-to-r from-[#F3A446] to-[#A06235] text-transparent bg-clip-text" i18n>
            Voting Game List</h1>

        <!-- Navigation & Search Bar -->
        <div class="flex flex-col md:flex-row justify-between gap-5 items-start md:items-center mb-8">
            <div class="flex items-center gap-4">
                <button matButton="elevated" (click)="goBack()">
                    <mat-icon>chevron_left</mat-icon>
                    <span i18n>Back</span>
                </button>
            </div>

            <div class="flex flex-1 flex-col md:flex-row gap-3 w-full md:w-auto items-center">
                <div class="flex-1 md:min-w-80">
                    <app-search-bar [keyword]="keyword()" (onResult)="onSearch($event)"
                        placeholder="Search voting sessions..." i18n-placeholder>
                    </app-search-bar>
                </div>
                <button matTooltip="Create New Voting Session" i18n-matTooltip matFab
                    (click)="createNewVotingSession()">
                    <mat-icon>add</mat-icon>
                </button>
            </div>
        </div>

        <!-- Loading State -->
        @if (loading()) {
        <div class="flex justify-center items-center py-20">
            <mat-progress-spinner mode="indeterminate" diameter="60" color="primary">
            </mat-progress-spinner>
        </div>
        } @else {

        <!-- Empty State -->
        @if (votingSessions().length === 0) {
        <div class="text-center py-20">
            <app-empty></app-empty>
            <div class="mt-6">
                <button matButton="elevated" (click)="createNewVotingSession()">
                    <mat-icon>add</mat-icon>
                    <span i18n>Create Your First Voting Session</span>
                </button>
            </div>
        </div>
        } @else {

        <!-- Voting Sessions Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            @for (session of votingSessions(); track session._id) {
            <mat-card class="hover:!shadow-xl hover:!-translate-y-1 !transition-all !duration-300 !cursor-pointer group"
                (click)="navigateToVotingSession(session._id)">

                <mat-card-header class="!pb-4">
                    <div mat-card-avatar
                        class="!bg-gradient-to-br from-[#F3A446] to-[#A06235] !text-white !flex !items-center !justify-center !w-12 !h-12 !rounded-xl">
                        <mat-icon class="!text-white !text-2xl !w-6 !h-6">how_to_vote</mat-icon>
                    </div>

                    <mat-card-title class="!text-lg !font-semibold line-clamp-2">
                        {{ session.title || 'Untitled Voting Session' }}
                    </mat-card-title>

                    <mat-card-subtitle class="!text-sm !text-gray-300 !mt-1">
                        @if (session.createdAt) {
                        <span>{{ session.createdAt | date: 'medium'}}</span>
                        }
                    </mat-card-subtitle>
                </mat-card-header>

                <mat-card-content class="!pt-0">
                    @if (session.description) {
                    <p class="text-sm mb-4 line-clamp-3">
                        {{ session.description }}
                    </p>
                    }

                    <!-- Session Stats -->
                    <div class="flex flex-wrap gap-3 mb-4">
                        <div
                            class="flex items-center gap-1 text-sm px-3 py-1 text-amber-600 rounded-full font-medium neumorphic-inset_dark">
                            <mat-icon class="!text-sm !w-3.5 !h-3.5">restaurant</mat-icon>
                            <span class="ml-2">{{ session.dishVoteItems.length }} </span>
                            <span i18n>dishes</span>
                        </div>

                        <div
                            class="flex items-center gap-1 text-sm text-amber-300 px-3 py-1 rounded-full font-medium neumorphic-inset_dark">
                            <mat-icon class="!text-sm !w-3.5 !h-3.5">how_to_vote</mat-icon>
                            <span class="ml-2">{{ getTotalVotes(session) }} </span>
                            <span i18n>votes</span>
                        </div>
                    </div>

                    <!-- Most Voted Dish -->
                    @if (getMostVotedDish(session); as mostVoted) {
                    <div class="neumorphic-container_dark border border-yellow-200 rounded-lg p-3 mb-4">
                        <div class="flex items-center gap-2 text-sm">
                            <mat-icon class="!text-yellow-600">emoji_events</mat-icon>
                            <span class="text-gray-500" i18n>Winner:</span>
                            <span class="font-semibold">
                                @if (mostVoted.isCustom) {
                                <span>{{ mostVoted.customTitle }}</span>
                                } @else {

                                <app-winner-title [slug]="mostVoted.slug"></app-winner-title>
                                }
                            </span>
                            <mat-chip class="text-xs font-medium">
                                {{ mostVoted.votes }} votes
                            </mat-chip>
                        </div>
                    </div>
                    }

                    <!-- Custom Dishes Indicator -->
                    @if (hasCustomDishes(session)) {
                    <div class="flex items-center gap-1 text-sm text-purple-600 mb-2">
                        <mat-icon class="!text-sm !w-4 !h-4">add_circle_outline</mat-icon>
                        <span i18n>Contains custom dishes</span>
                    </div>
                    }
                </mat-card-content>

                <mat-card-actions class="!pt-5 !flex !justify-between !items-center !mt-auto">
                    <div class="flex gap-2">
                        <button matButton="elevated"
                            (click)="$event.stopPropagation(); navigateToVotingSession(session._id)">
                            <mat-icon class="!text-sm">visibility</mat-icon>
                            <span i18n>View</span>
                        </button>

                        <button mat-icon-button [matMenuTriggerFor]="sessionMenu"
                            class="!text-gray-500 hover:!text-gray-700 hover:!bg-gray-50 !transition-all !duration-200"
                            (click)="$event.stopPropagation()" matTooltip="More actions" i18n-matTooltip>
                            <mat-icon>more_vert</mat-icon>
                        </button>
                    </div>

                    <div class="text-xs text-gray-500" [matTooltip]="session._id">
                        <span>ID: {{ session._id.slice(-8) }}</span>
                    </div>
                </mat-card-actions>

                <!-- Menu for additional actions -->
                <mat-menu #sessionMenu="matMenu">
                    <button mat-menu-item (click)="navigateToVotingSession(session._id)">
                        <mat-icon>launch</mat-icon>
                        <span i18n>Open Session</span>
                    </button>
                    <button mat-menu-item (click)="$any(this).openShareDialog(session)">
                        <mat-icon>share</mat-icon>
                        <span i18n>Share</span>
                    </button>
                    <mat-divider></mat-divider>
                    <button mat-menu-item class="!text-red-600">
                        <mat-icon class="!text-red-600">delete</mat-icon>
                        <span i18n>Delete</span>
                    </button>
                </mat-menu>

            </mat-card>
            }
        </div>

        <!-- Pagination -->
        <div class="flex justify-center">
            <mat-paginator [length]="total()" [pageSize]="limit()" [pageIndex]="currentPage() - 1"
                [pageSizeOptions]="[5, 10, 25, 50]" [showFirstLastButtons]="true" (page)="onPageChange($event)">
            </mat-paginator>
        </div>
        }
        }
    </div>
</section>