<section id="main" class="min-h-screen p-5 md:p-10 mt-20 bg-gradient-to-br from-gray-900 via-purple-900/20 to-gray-900">
    <div class="max-w-7xl mx-auto">
        <!-- Header Section with Glassmorphic Card -->
        <div class="relative mb-12 overflow-hidden rounded-3xl backdrop-blur-xl bg-white/5 border border-white/10 p-8 shadow-2xl">
            <div class="absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10"></div>
            <div class="relative z-10">
                <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                    <div class="text-center md:text-left">
                        <div class="flex items-center gap-3 justify-center md:justify-start mb-3">
                            <mat-icon class="text-blue-400 text-5xl">collections_bookmark</mat-icon>
                            <h1 class="text-4xl md:text-5xl font-bold text-white" i18n>My Dish Collections</h1>
                        </div>
                        <p class="text-gray-300 text-lg" i18n>
                            Create and organize your favorite dishes for any occasion
                        </p>
                    </div>
                    <button mat-fab extended color="primary" 
                        (click)="toggleCreateForm()"
                        class="!bg-gradient-to-r !from-blue-500 !to-purple-500 hover:!from-blue-600 hover:!to-purple-600 !shadow-lg hover:!shadow-xl transition-all duration-300 !px-8">
                        <mat-icon>{{ showCreateForm() ? 'close' : 'add' }}</mat-icon>
                        <span i18n>{{ showCreateForm() ? 'Cancel' : 'New Collection' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Create Collection Form -->
        @if (showCreateForm()) {
        <div class="mb-8 rounded-3xl backdrop-blur-xl bg-white/5 border border-white/10 p-8 shadow-2xl animate-in slide-in-from-top duration-500">
            <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                <mat-icon class="text-purple-400">add_circle</mat-icon>
                <span i18n>Create New Collection</span>
            </h2>
            <form [formGroup]="collectionForm" (ngSubmit)="createCollection()" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Collection Name -->
                    <mat-form-field appearance="outline" class="w-full">
                        <mat-label i18n>Collection Name</mat-label>
                        <input matInput formControlName="name" placeholder="e.g., My Birthday Dishes" i18n-placeholder>
                        <mat-icon matPrefix class="text-blue-400 mr-2">label</mat-icon>
                        <mat-error *ngIf="collectionForm.get('name')?.hasError('required')" i18n>Name is required</mat-error>
                    </mat-form-field>

                    <!-- Occasion -->
                    <mat-form-field appearance="outline" class="w-full">
                        <mat-label i18n>Occasion</mat-label>
                        <mat-select formControlName="occasion">
                            <mat-option value="">None</mat-option>
                            @for (occasion of occasions; track occasion) {
                            <mat-option [value]="occasion">{{ occasion | titlecase }}</mat-option>
                            }
                        </mat-select>
                        <mat-icon matPrefix class="text-purple-400 mr-2">event</mat-icon>
                    </mat-form-field>
                </div>

                <!-- Description -->
                <mat-form-field appearance="outline" class="w-full">
                    <mat-label i18n>Description</mat-label>
                    <textarea matInput formControlName="description" rows="3" 
                        placeholder="Describe your collection..." i18n-placeholder></textarea>
                    <mat-icon matPrefix class="text-green-400 mr-2">description</mat-icon>
                </mat-form-field>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Event Date -->
                    <mat-form-field appearance="outline" class="w-full">
                        <mat-label i18n>Event Date</mat-label>
                        <input matInput [matDatepicker]="picker" formControlName="eventDate">
                        <mat-datepicker-toggle matIconPrefix [for]="picker"></mat-datepicker-toggle>
                        <mat-datepicker #picker></mat-datepicker>
                    </mat-form-field>

                    <!-- Icon -->
                    <mat-form-field appearance="outline" class="w-full">
                        <mat-label i18n>Icon</mat-label>
                        <mat-select formControlName="icon">
                            @for (icon of availableIcons; track icon.name) {
                            <mat-option [value]="icon.name">
                                <div class="flex items-center gap-2">
                                    <mat-icon>{{ icon.name }}</mat-icon>
                                    <span>{{ icon.label }}</span>
                                </div>
                            </mat-option>
                            }
                        </mat-select>
                        <mat-icon matPrefix class="mr-2">{{ collectionForm.get('icon')?.value }}</mat-icon>
                    </mat-form-field>

                    <!-- Color -->
                    <mat-form-field appearance="outline" class="w-full">
                        <mat-label i18n>Color</mat-label>
                        <mat-select formControlName="color">
                            @for (color of availableColors; track color.value) {
                            <mat-option [value]="color.value">
                                <div class="flex items-center gap-2">
                                    <span class="w-6 h-6 rounded-full border-2 border-white" 
                                        [style.background-color]="color.value"></span>
                                    <span>{{ color.name }}</span>
                                </div>
                            </mat-option>
                            }
                        </mat-select>
                        <span matPrefix class="w-6 h-6 rounded-full border-2 border-white mr-2" 
                            [style.background-color]="collectionForm.get('color')?.value"></span>
                    </mat-form-field>
                </div>

                <!-- Public Toggle -->
                <div class="flex items-center gap-3 p-4 rounded-xl bg-white/5 border border-white/10">
                    <mat-slide-toggle formControlName="isPublic" color="primary">
                        <span class="text-white" i18n>Make this collection public</span>
                    </mat-slide-toggle>
                    <mat-icon class="text-gray-400 text-sm" matTooltip="Public collections can be viewed by others" i18n-matTooltip>
                        info
                    </mat-icon>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-end gap-4">
                    <button mat-stroked-button type="button" (click)="toggleCreateForm()" class="!text-white !border-white/20">
                        <mat-icon>close</mat-icon>
                        <span i18n>Cancel</span>
                    </button>
                    <button mat-raised-button type="submit" 
                        [disabled]="collectionForm.invalid || loading()"
                        class="!bg-gradient-to-r !from-blue-500 !to-purple-500 !text-white hover:!shadow-xl transition-all">
                        <mat-icon>save</mat-icon>
                        <span i18n>Create Collection</span>
                    </button>
                </div>
            </form>
        </div>
        }

        <!-- Collections Grid -->
        @if (loading()) {
        <div class="flex justify-center items-center py-20">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500"></div>
        </div>
        } @else if (collections().length === 0 && !showCreateForm()) {
        <div class="text-center py-20 rounded-3xl backdrop-blur-xl bg-white/5 border border-white/10">
            <mat-icon class="text-gray-400 text-8xl mb-4">collections_bookmark</mat-icon>
            <h3 class="text-2xl font-bold text-white mb-2" i18n>No Collections Yet</h3>
            <p class="text-gray-400 mb-6" i18n>Create your first collection to get started!</p>
            <button mat-raised-button color="primary" (click)="toggleCreateForm()">
                <mat-icon>add</mat-icon>
                <span i18n>Create Collection</span>
            </button>
        </div>
        } @else if (collections().length > 0) {
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            @for (collection of collections(); track collection._id) {
            <div class="group relative overflow-hidden rounded-3xl backdrop-blur-xl bg-white/5 border border-white/10 hover:border-white/30 transition-all duration-300 hover:scale-105 hover:shadow-2xl">
                <!-- Colored Accent Bar -->
                <div class="h-2 w-full" [style.background-color]="collection.color || '#3b82f6'"></div>
                
                <!-- Card Content -->
                <div class="p-6">
                    <!-- Header with Icon and Menu -->
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-14 h-14 rounded-2xl flex items-center justify-center text-white text-2xl shadow-lg"
                                [style.background-color]="collection.color || '#3b82f6'">
                                <mat-icon>{{ collection.icon || 'collections' }}</mat-icon>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-white line-clamp-1">{{ collection.name }}</h3>
                                @if (collection.occasion) {
                                <span class="text-sm text-gray-400 flex items-center gap-1 mt-1">
                                    <mat-icon class="text-xs">event</mat-icon>
                                    {{ collection.occasion | titlecase }}
                                </span>
                                }
                            </div>
                        </div>
                        
                        <!-- Actions Menu -->
                        <button mat-icon-button [matMenuTriggerFor]="menu" class="text-white">
                            <mat-icon>more_vert</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                            <button mat-menu-item>
                                <mat-icon class="text-blue-400">edit</mat-icon>
                                <span i18n>Edit</span>
                            </button>
                            <button mat-menu-item (click)="duplicateCollection(collection)">
                                <mat-icon class="text-green-400">content_copy</mat-icon>
                                <span i18n>Duplicate</span>
                            </button>
                            <button mat-menu-item>
                                <mat-icon class="text-purple-400">share</mat-icon>
                                <span i18n>Share</span>
                            </button>
                            <mat-divider></mat-divider>
                            <button mat-menu-item (click)="deleteCollection(collection._id)" class="!text-red-400">
                                <mat-icon class="text-red-400">delete</mat-icon>
                                <span i18n>Delete</span>
                            </button>
                        </mat-menu>
                    </div>

                    <!-- Description -->
                    @if (collection.description) {
                    <p class="text-gray-300 text-sm mb-4 line-clamp-2">{{ collection.description }}</p>
                    }

                    <!-- Stats -->
                    <div class="flex items-center gap-4 mb-4">
                        <div class="flex items-center gap-2">
                            <mat-icon class="text-blue-400 text-sm">restaurant</mat-icon>
                            <span class="text-white font-semibold">{{ collection.dishSlugs.length || 0 }}</span>
                            <span class="text-gray-400 text-sm" i18n>dishes</span>
                        </div>
                        @if (collection.eventDate) {
                        <div class="flex items-center gap-2">
                            <mat-icon class="text-purple-400 text-sm">calendar_today</mat-icon>
                            <span class="text-gray-400 text-sm">{{ collection.eventDate | date:'mediumDate' }}</span>
                        </div>
                        }
                    </div>

                    <!-- Tags -->
                    @if (collection.tags && collection.tags.length > 0) {
                    <div class="flex flex-wrap gap-2 mb-4">
                        @for (tag of collection.tags.slice(0, 3); track tag) {
                        <span class="px-3 py-1 rounded-full bg-white/10 text-white text-xs border border-white/20">
                            {{ tag }}
                        </span>
                        }
                        @if (collection.tags.length > 3) {
                        <span class="px-3 py-1 rounded-full bg-white/10 text-gray-400 text-xs">
                            +{{ collection.tags.length - 3 }}
                        </span>
                        }
                    </div>
                    }

                    <!-- Footer Actions -->
                    <div class="flex items-center justify-between pt-4 border-t border-white/10">
                        <div class="flex items-center gap-2">
                            @if (collection.isPublic) {
                            <mat-icon class="text-green-400 text-sm" matTooltip="Public collection" i18n-matTooltip>public</mat-icon>
                            } @else {
                            <mat-icon class="text-gray-400 text-sm" matTooltip="Private collection" i18n-matTooltip>lock</mat-icon>
                            }
                        </div>
                        <button mat-raised-button 
                            [style.background-color]="collection.color || '#3b82f6'"
                            class="!text-white !shadow-lg hover:!shadow-xl transition-all">
                            <mat-icon>arrow_forward</mat-icon>
                            <span i18n>View Dishes</span>
                        </button>
                    </div>
                </div>

                <!-- Hover Gradient Overlay -->
                <div class="absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-white/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"></div>
            </div>
            }
        </div>
        }
    </div>
</section>