<div class="profile-container min-h-screen py-8 px-4 relative overflow-hidden">
    <!-- Animated Background -->
    <div class="background-animation">
        <div class="gradient-orb orb-1"></div>
        <div class="gradient-orb orb-2"></div>
        <div class="gradient-orb orb-3"></div>
        <div class="gradient-sphere sphere-1"></div>
        <div class="gradient-sphere sphere-2"></div>
    </div>

    <!-- Loading Spinner -->
    @if (isLoading()) {
    <div class="flex justify-center items-center min-h-screen">
        <div class="loading-container text-center">
            <div class="spinner-wrapper relative">
                <div class="spinner-glow"></div>
                <mat-spinner diameter="80" class="relative z-10"></mat-spinner>
            </div>
            <div class="loading-text mt-6">
                <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-2 animate-pulse" i18n>
                    Loading Profile
                </h3>
                <div class="flex items-center justify-center gap-1">
                    <span class="loading-dot"></span>
                    <span class="loading-dot delay-1"></span>
                    <span class="loading-dot delay-2"></span>
                </div>
            </div>
        </div>
    </div>
    } @else if (user()) {

    <!-- Profile Content -->
    <div class="profile-content max-w-5xl mx-auto relative z-10">
        <!-- Header Card -->
        <mat-card class="profile-header-card mb-6 overflow-hidden">
            <div class="profile-banner relative h-32 bg-gradient-to-r from-orange-500 via-amber-500 to-yellow-500">
                <div class="absolute inset-0 bg-black/20"></div>
                <button mat-icon-button (click)="goBack()" class="absolute top-4 left-4" i18n-aria-label
                    aria-label="Go back">
                    <mat-icon class="text-white">arrow_back</mat-icon>
                </button>
            </div>

            <div class="profile-header-content px-6 pb-6">
                <div class="flex flex-col md:flex-row items-center md:items-end gap-6 -mt-16 relative z-10">
                    <!-- Avatar -->
                    <div class="avatar-container relative">
                        <img referrerpolicy="no-referrer" [src]="avatarUrl()" [alt]="user()?.name || 'User Avatar'"
                            class="w-32 h-32 rounded-full border-4 border-white shadow-2xl object-cover" />
                        <div class="absolute bottom-2 right-2 w-6 h-6 bg-green-500 rounded-full border-2 border-white">
                        </div>
                    </div>

                    <!-- User Info -->
                    <div class="flex-1 text-center md:text-left">
                        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-1">
                            {{ user()?.name || 'Anonymous User' }}
                        </h1>
                        <p
                            class="text-gray-600 dark:text-gray-300 flex items-center gap-2 justify-center md:justify-start">
                            <mat-icon class="text-sm">email</mat-icon>
                            {{ user()?.email }}
                        </p>
                        <div class="mt-3">
                            <div
                                class="bg-gradient-to-r from-orange-400 to-amber-500 text-white inline-block px-3 py-1 rounded-full shadow-md">
                                <div class="flex items-center gap-1">
                                    <mat-icon class="text-sm">badge</mat-icon>
                                    <span>{{ user()?.roleName || 'User' }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex gap-2">
                        @if (!isEditing()) {
                        <button mat-raised-button color="primary" (click)="toggleEdit()" class="shadow-lg">
                            <mat-icon>edit</mat-icon>
                            <span i18n>Edit Profile</span>
                        </button>
                        } @else {
                        <button mat-raised-button color="warn" (click)="toggleEdit()" class="shadow-lg">
                            <mat-icon>close</mat-icon>
                            <span i18n>Cancel</span>
                        </button>
                        <button mat-raised-button color="primary" (click)="saveProfile()"
                            [disabled]="profileForm.invalid || isLoading()" class="shadow-lg">
                            <mat-icon>save</mat-icon>
                            <span i18n>Save Changes</span>
                        </button>
                        }
                    </div>
                </div>
            </div>
        </mat-card>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column - Stats & Info -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Stats Card -->
                <mat-card class="stats-card">
                    <mat-card-header>
                        <mat-card-title class="!flex !items-center gap-2">
                            <mat-icon class="text-orange-500">insights</mat-icon>
                            <span i18n>Account Stats</span>
                        </mat-card-title>
                    </mat-card-header>
                    <mat-card-content class="space-y-4 mt-4">
                        <div class="stat-item">
                            <div
                                class="flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <mat-icon class="text-blue-500">cake</mat-icon>
                                    <span class="text-sm font-medium" i18n>Account Age</span>
                                </div>
                                <span class="font-bold text-blue-600 dark:text-blue-400">{{ getAccountAge() }}</span>
                            </div>
                        </div>

                        <div class="stat-item">
                            <div
                                class="flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <mat-icon class="text-green-500">calendar_today</mat-icon>
                                    <span class="text-sm font-medium" i18n>Joined</span>
                                </div>
                                <span class="font-bold text-green-600 dark:text-green-400">{{
                                    getFormattedDate(user()?.createdAt) }}</span>
                            </div>
                        </div>

                        <div class="stat-item">
                            <div
                                class="flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <mat-icon class="text-purple-500">update</mat-icon>
                                    <span class="text-sm font-medium" i18n>Last Updated</span>
                                </div>
                                <span class="font-bold text-purple-600 dark:text-purple-400">{{
                                    getFormattedDate(user()?.updatedAt) }}</span>
                            </div>
                        </div>
                    </mat-card-content>
                </mat-card>

                <!-- Quick Info Card -->
                <mat-card>
                    <mat-card-header>
                        <mat-card-title class="!flex !items-center gap-2">
                            <mat-icon class="text-amber-500">info</mat-icon>
                            <span i18n>Quick Info</span>
                        </mat-card-title>
                    </mat-card-header>
                    <mat-card-content class="space-y-3 mt-4">
                        @if (user()?.googleID) {
                        <div class="!flex !items-center gap-2 text-sm">
                            <mat-icon class="!text-green-500">check_circle</mat-icon>
                            <span i18n>Google Connected</span>
                        </div>
                        }
                        @if (user()?.facebookID) {
                        <div class="!flex !items-center gap-2 text-sm">
                            <mat-icon class="text-blue-600">check_circle</mat-icon>
                            <span i18n>Facebook Connected</span>
                        </div>
                        }
                        @if (user()?.githubID) {
                        <div class="flex items-center gap-2 text-sm">
                            <mat-icon class="text-gray-800">check_circle</mat-icon>
                            <span i18n>GitHub Connected</span>
                        </div>
                        }
                        @if (user()?.appleID) {
                        <div class="flex items-center gap-2 text-sm">
                            <mat-icon class="text-gray-900">check_circle</mat-icon>
                            <span i18n>Apple Connected</span>
                        </div>
                        }
                        @if (!user()?.googleID && !user()?.facebookID && !user()?.githubID && !user()?.appleID) {
                        <div class="flex items-center gap-2 text-sm text-gray-500">
                            <mat-icon>info</mat-icon>
                            <span i18n>No social accounts connected</span>
                        </div>
                        }
                    </mat-card-content>
                </mat-card>
            </div>

            <!-- Right Column - Profile Details Form -->
            <div class="lg:col-span-2">
                <mat-card class="profile-details-card">
                    <mat-card-header>
                        <mat-card-title class="!flex !items-center gap-2">
                            <mat-icon class="text-orange-500">person</mat-icon>
                            <span i18n>Profile Details</span>
                        </mat-card-title>
                    </mat-card-header>
                    <mat-card-content class="mt-6">
                        <form [formGroup]="profileForm" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Name Field -->
                                <mat-form-field appearance="outline" class="w-full">
                                    <mat-label i18n>Full Name</mat-label>
                                    <input matInput formControlName="name" [readonly]="!isEditing()"
                                        placeholder="Enter your full name" i18n-placeholder />
                                    <mat-icon matPrefix>person</mat-icon>
                                    @if (profileForm.get('name')?.hasError('required') && isEditing()) {
                                    <mat-error i18n>Name is required</mat-error>
                                    }
                                    @if (profileForm.get('name')?.hasError('minlength') && isEditing()) {
                                    <mat-error i18n>Name must be at least 2 characters</mat-error>
                                    }
                                </mat-form-field>

                                <!-- Email Field (Disabled) -->
                                <mat-form-field appearance="outline" class="w-full">
                                    <mat-label i18n>Email Address</mat-label>
                                    <input matInput formControlName="email" type="email" readonly />
                                    <mat-icon matPrefix>email</mat-icon>
                                    <mat-hint i18n>Email cannot be changed</mat-hint>
                                </mat-form-field>

                                <!-- Phone Field -->
                                <mat-form-field appearance="outline" class="w-full">
                                    <mat-label i18n>Phone Number</mat-label>
                                    <input matInput formControlName="phone" [readonly]="!isEditing()"
                                        placeholder="Enter phone number" i18n-placeholder type="tel" />
                                    <mat-icon matPrefix>phone</mat-icon>
                                    @if (profileForm.get('phone')?.hasError('pattern') && isEditing()) {
                                    <mat-error i18n>Please enter a valid phone number (10-15 digits)</mat-error>
                                    }
                                </mat-form-field>

                                <!-- Date of Birth Field -->
                                <mat-form-field appearance="outline" class="w-full">
                                    <mat-label i18n>Date of Birth</mat-label>
                                    <input matInput [matDatepicker]="picker" formControlName="dateOfBirth"
                                        [readonly]="!isEditing()" />
                                    <mat-icon matPrefix>cake</mat-icon>
                                    @if (isEditing()) {
                                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                    }
                                    <mat-datepicker #picker></mat-datepicker>
                                </mat-form-field>
                            </div>

                            <!-- Address Field (Full Width) -->
                            <mat-form-field appearance="outline" class="w-full">
                                <mat-label i18n>Address</mat-label>
                                <textarea matInput formControlName="address" [readonly]="!isEditing()" rows="3"
                                    placeholder="Enter your address" i18n-placeholder></textarea>
                                <mat-icon matPrefix>location_on</mat-icon>
                            </mat-form-field>
                        </form>
                    </mat-card-content>
                </mat-card>
            </div>
        </div>
    </div>
    }
</div>